<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSS Aggregator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@2.47.0/tabler-icons.min.css">
    <style>
        .slider-container {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .slider-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .slider-percentage {
            font-size: 0.875rem;
            font-weight: 600;
            color: #4E61D3;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- Header -->
        <div class="mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">RSS Aggregator</h1>
            <p class="text-gray-600">Filter, sort, and explore AI safety research papers</p>
        </div>

        <div class="flex flex-col lg:flex-row gap-6">
            <!-- Filters Sidebar -->
            <aside class="w-full lg:w-96 flex-shrink-0 space-y-6">
                <div class="bg-white rounded-lg shadow-md p-6 space-y-6">
                    <div>
                        <h2 class="text-xl font-semibold mb-3 text-gray-800">Date Filter</h2>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Quick Select</label>
                                <select id="dateQuick" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500">
                                    <option value="7">Last 7 days</option>
                                    <option value="30">Last 30 days</option>
                                    <option value="90">Last 90 days</option>
                                    <option value="365">Last year</option>
                                    <option value="all">All time</option>
                                    <option value="custom">Custom range...</option>
                                </select>
                            </div>
                            <div id="customDateRange" class="hidden space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Start Date</label>
                                    <input type="date" id="dateStart" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">End Date</label>
                                    <input type="date" id="dateEnd" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500">
                                </div>
                            </div>
                            <div class="border-t border-gray-200 pt-4 space-y-4">
                                <div class="text-sm text-gray-500 font-semibold uppercase tracking-wide">Primary Focus</div>
                                <div id="primaryFocusToggles" class="flex flex-wrap gap-2">
                                    <!-- Primary focus toggles populated by JavaScript -->
                                </div>
                                <div class="text-sm text-gray-500 font-semibold uppercase tracking-wide mt-4">Failure Modes</div>
                                <div id="failureModeToggles" class="flex flex-wrap gap-2">
                                    <!-- Failure mode toggles populated by JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <h2 class="text-xl font-semibold mb-3 text-gray-800">Feed Selection</h2>
                        <div id="feedToggles" class="flex flex-wrap gap-2">
                            <!-- Feed toggles populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold text-gray-800">Score Weights</h2>
                        <button id="resetWeights" class="text-sm text-blue-600 hover:text-blue-800 font-medium">Reset All</button>
                    </div>
                    <div class="space-y-4">
                        <div class="slider-container">
                            <div class="slider-header">
                                <label class="text-sm font-medium text-gray-700">Interpretability</label>
                                <span class="slider-percentage" id="weight-interpretability-pct">16.7%</span>
                            </div>
                            <input type="range" id="weight-interpretability" min="0" max="100" value="0" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600">
                        </div>
                        <div class="slider-container">
                            <div class="slider-header">
                                <label class="text-sm font-medium text-gray-700">Understanding</label>
                                <span class="slider-percentage" id="weight-understanding-pct">16.7%</span>
                            </div>
                            <input type="range" id="weight-understanding" min="0" max="100" value="0" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600">
                        </div>
                        <div class="slider-container">
                            <div class="slider-header">
                                <label class="text-sm font-medium text-gray-700">Safety</label>
                                <span class="slider-percentage" id="weight-safety-pct">16.7%</span>
                            </div>
                            <input type="range" id="weight-safety" min="0" max="100" value="0" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600">
                        </div>
                        <div class="slider-container">
                            <div class="slider-header">
                                <label class="text-sm font-medium text-gray-700">Technicality</label>
                                <span class="slider-percentage" id="weight-technicality-pct">16.7%</span>
                            </div>
                            <input type="range" id="weight-technicality" min="0" max="100" value="0" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600">
                        </div>
                        <div class="slider-container">
                            <div class="slider-header">
                                <label class="text-sm font-medium text-gray-700">Surprisal</label>
                                <span class="slider-percentage" id="weight-surprisal-pct">16.7%</span>
                            </div>
                            <input type="range" id="weight-surprisal" min="0" max="100" value="0" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600">
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-md p-6 text-center">
                    <button id="showResults" class="w-full px-6 py-3 bg-green-600 text-white text-lg font-semibold rounded-md hover:bg-green-700 transition shadow-md">
                        Show Results
                    </button>
                </div>
            </aside>

            <!-- Main Content -->
            <section class="flex-1 space-y-6">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-semibold text-gray-800">Articles <span id="articleCount" class="text-gray-500 text-lg"></span></h2>
                        <button id="shareLink" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition">
                            Share Current View
                        </button>
                    </div>
                    <div id="articleList" class="space-y-4">
                        <!-- Articles populated by JavaScript -->
                    </div>
                </div>
            </section>
        </div>
    </div>
<script>

        const FAILURE_MODES = ['human-misuse', 'misalignment', 'societal-disruption', 'other', 'non-applicable'];
        const PRIMARY_FOCUSES = ['interpretability', 'alignment', 'robustness', 'control', 'other'];
        const PRIMARY_FOCUS_COLORS = {
            interpretability: '#a855f7',
            alignment: '#e06814',
            robustness: '#16a34a',
            control: '#e6126e',
            other: '#475569'
        };
        const GRID_KEYS = FAILURE_MODES.flatMap(fm => PRIMARY_FOCUSES.map(pf => `${fm}:${pf}`));
        const formatLabel = (value) => value.replace(/-/g, ' ').replace(/\b\w/g, (char) => char.toUpperCase());
        const PRIMARY_FOCUS_ICONS = {
            interpretability: 'ti ti-microscope',
            alignment: 'ti ti-heart-handshake',
            robustness: 'ti ti-shield-half',
            control: 'ti ti-prison'
        };
        const FAILURE_MODE_ICONS = {
            'human-misuse': 'ti ti-user-exclamation',
            misalignment: 'ti ti-mood-sad-dizzy',
            'societal-disruption': 'ti ti-world-bolt',
            other: 'ti ti-route-x-2'
        };

        // Global state
        let allArticles = [];
        let allFeeds = [];
        let selectedFailureModes = new Set();
        let selectedPrimaryFocuses = new Set();
        let selectedFeeds = new Set();

        function getCurrentFilters() {
            const dateQuick = document.getElementById('dateQuick').value;
            const weights = {
                interpretability: parseInt(document.getElementById('weight-interpretability').value, 10),
                understanding: parseInt(document.getElementById('weight-understanding').value, 10),
                safety: parseInt(document.getElementById('weight-safety').value, 10),
                technicality: parseInt(document.getElementById('weight-technicality').value, 10),
                surprisal: parseInt(document.getElementById('weight-surprisal').value, 10)
            };

            const dateFilter = { type: dateQuick };
            if (dateQuick === 'custom') {
                dateFilter.start = document.getElementById('dateStart').value;
                dateFilter.end = document.getElementById('dateEnd').value;
            }

            return { dateFilter, weights };
        }

        function getNormalizedWeights(weights) {
            const sum = Object.values(weights).reduce((a, b) => a + b, 0);
            if (sum === 0) {
                return {
                    interpretability: 1 / 5,
                    understanding: 1 / 5,
                    safety: 1 / 5,
                    technicality: 1 / 5,
                    surprisal: 1 / 5
                };
            }
            const normalized = {};
            for (const key in weights) {
                normalized[key] = weights[key] / sum;
            }
            return normalized;
        }

        function updateWeightDisplays() {
            const weightKeys = ['interpretability', 'understanding', 'safety', 'technicality', 'surprisal'];
            const weights = {};
            weightKeys.forEach(key => {
                weights[key] = parseInt(document.getElementById(`weight-${key}`).value, 10);
            });

            const normalized = getNormalizedWeights(weights);
            weightKeys.forEach(key => {
                const pct = (normalized[key] * 100).toFixed(1);
                document.getElementById(`weight-${key}-pct`).textContent = `${pct}%`;
            });
        }

        function filterByDate(articles, dateFilter) {
            if (dateFilter.type === 'all') {
                return articles;
            }

            const now = Date.now() / 1000;

            if (dateFilter.type === 'custom') {
                if (!dateFilter.start && !dateFilter.end) return articles;

                const startTime = dateFilter.start ? new Date(dateFilter.start).getTime() / 1000 : 0;
                const endTime = dateFilter.end ? (new Date(dateFilter.end).getTime() / 1000) + 86399.999 : now;

                return articles.filter(article => {
                    if (!article.published_timestamp) return true;
                    return article.published_timestamp >= startTime && article.published_timestamp <= endTime;
                });
            }

            const days = parseInt(dateFilter.type, 10);
            if (isNaN(days)) {
                return articles;
            }

            const cutoff = now - (days * 24 * 60 * 60);

            return articles.filter(article => {
                if (!article.published_timestamp) return true;
                return article.published_timestamp >= cutoff;
            });
        }

        function filterByCategories(articles) {
            if (selectedFailureModes.size === 0 && selectedPrimaryFocuses.size === 0) {
                return articles;
            }

            return articles.filter(article => {
                const failureMatch = selectedFailureModes.size === 0 || selectedFailureModes.has(article.failure_mode);
                const focusMatch = selectedPrimaryFocuses.size === 0 || selectedPrimaryFocuses.has(article.primary_focus);
                return failureMatch && focusMatch;
            });
        }

        function filterByFeeds(articles) {
            if (selectedFeeds.size === 0) {
                return articles;
            }
            return articles.filter(article => selectedFeeds.has(article.feed_name));
        }

        function calculateScore(article, weights) {
            return (
                article.interpretability * weights.interpretability +
                article.understanding * weights.understanding +
                article.safety * weights.safety +
                article.technicality * weights.technicality +
                article.surprisal * weights.surprisal
            );
        }

        function sortArticles(articles, weights) {
            const normalized = getNormalizedWeights(weights);
            return articles.sort((a, b) => {
                const scoreA = calculateScore(a, normalized);
                const scoreB = calculateScore(b, normalized);
                return scoreB - scoreA;
            });
        }

        function renderFeedToggles() {
            const container = document.getElementById('feedToggles');
            container.innerHTML = '';

            allFeeds.forEach(feed => {
                const isSelected = selectedFeeds.size === 0 || selectedFeeds.has(feed);
                const toggle = document.createElement('button');
                toggle.className = 'px-4 py-2 rounded-md font-medium transition border';
                toggle.style.cssText = isSelected
                    ? 'background-color: #eef2ff; color: #1f2937; border-color: #4E61D3;'
                    : 'background-color: #f9fafb; color: #1f2937; border-color: #d1d5db;';
                toggle.textContent = feed;
                toggle.addEventListener('click', () => toggleFeed(feed));
                container.appendChild(toggle);
            });
        }

        function toggleFeed(feed) {
            if (selectedFeeds.has(feed)) {
                selectedFeeds.delete(feed);
            } else {
                selectedFeeds.add(feed);
            }
            renderFeedToggles();
        }

        function renderArticles(articles) {
            const container = document.getElementById('articleList');
            const countElement = document.getElementById('articleCount');

            countElement.textContent = `(${articles.length})`;

            if (articles.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">No articles match your filters.</p>';
                return;
            }

            container.innerHTML = articles.map(article => {
                const date = article.published ? new Date(article.published).toLocaleDateString() : 'Unknown date';
                const keywords = article.keywords.join(', ');
                const focusColor = PRIMARY_FOCUS_COLORS[article.primary_focus] || '#4E61D3';
                const focusIconClass = PRIMARY_FOCUS_ICONS[article.primary_focus];
                const failureIconClass = FAILURE_MODE_ICONS[article.failure_mode];
                const focusIconMarkup = focusIconClass ? `<i class="${focusIconClass} text-base" aria-hidden="true" title="${formatLabel(article.primary_focus)}"></i>` : '';
                const failureIconMarkup = failureIconClass ? `<i class="${failureIconClass} text-base" aria-hidden="true" title="${formatLabel(article.failure_mode)}"></i>` : '';
                const iconGroupMarkup = (focusIconMarkup || failureIconMarkup) ? `<div class="flex gap-2 text-gray-900">${focusIconMarkup}${failureIconMarkup}</div>` : '';

                return `
                    <div class="border rounded-lg p-6 hover:shadow-lg transition" style="border-color: ${focusColor};">
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="text-xl font-semibold text-blue-600 hover:text-blue-800">
                                <a href="${article.link}" target="_blank" class="hover:underline">${article.title}</a>
                            </h3>
                            <div class="flex flex-col items-end gap-1 ml-4">
                                <span class="text-sm text-gray-500 whitespace-nowrap">${date}</span>
                                ${iconGroupMarkup}
                            </div>
                        </div>

                        <div class="mb-3">
                            <span class="inline-block bg-blue-100 text-blue-800 text-xs font-semibold px-2 py-1 rounded mr-2">
                                ${article.feed_name}
                            </span>
                            <span class="inline-block bg-purple-100 text-purple-800 text-xs font-semibold px-2 py-1 rounded mr-2">
                                ${article.failure_mode}
                            </span>
                            <span class="inline-block text-xs font-semibold px-2 py-1 rounded" style="background-color: ${(PRIMARY_FOCUS_COLORS[article.primary_focus] || '#4E61D3')}22; color: ${PRIMARY_FOCUS_COLORS[article.primary_focus] || '#4E61D3'};">
                                ${article.primary_focus}
                            </span>
                        </div>

                        <div class="mb-3">
                            <p class="text-gray-700 mb-2"><strong>Summary:</strong> ${article.summary_en || 'No summary available'}</p>
                            <p class="text-gray-700"><strong>摘要：</strong> ${article.summary_cn || '无摘要'}</p>
                        </div>

                        ${keywords ? `<div class="mb-3"><p class="text-sm text-gray-600"><strong>Keywords:</strong> ${keywords}</p></div>` : ''}

                        <div class="flex gap-4 text-sm">
                            <span class="text-gray-600"><strong>Interpretability:</strong> ${article.interpretability}</span>
                            <span class="text-gray-600"><strong>Understanding:</strong> ${article.understanding}</span>
                            <span class="text-gray-600"><strong>Safety:</strong> ${article.safety}</span>
                            <span class="text-gray-600"><strong>Technicality:</strong> ${article.technicality}</span>
                            <span class="text-gray-600"><strong>Surprisal:</strong> ${article.surprisal}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderFailureModeToggles() {
            const container = document.getElementById('failureModeToggles');
            container.innerHTML = '';

            FAILURE_MODES.forEach(mode => {
                const isSelected = selectedFailureModes.size === 0 || selectedFailureModes.has(mode);
                const toggle = document.createElement('button');
                const iconClass = FAILURE_MODE_ICONS[mode];
                toggle.className = 'px-4 py-2 rounded-md font-medium transition flex items-center gap-2 border';
                toggle.style.cssText = isSelected
                    ? 'background-color: #f3f4f6; color: #1f2937; border-color: #475569;'
                    : 'background-color: #f3f4f6; color: #1f2937; border-color: #e5e7eb;';
                toggle.setAttribute('title', formatLabel(mode));
                toggle.innerHTML = `
                    ${iconClass ? `<i class="${iconClass} text-base" aria-hidden="true"></i>` : ''}
                    <span>${formatLabel(mode)}</span>
                `;
                toggle.addEventListener('click', () => toggleFailureMode(mode));
                container.appendChild(toggle);
            });
        }

        function toggleFailureMode(mode) {
            if (selectedFailureModes.has(mode)) {
                selectedFailureModes.delete(mode);
            } else {
                selectedFailureModes.add(mode);
            }
            renderFailureModeToggles();
        }

        function renderPrimaryFocusToggles() {
            const container = document.getElementById('primaryFocusToggles');
            container.innerHTML = '';

            PRIMARY_FOCUSES.forEach(focus => {
                const isSelected = selectedPrimaryFocuses.size === 0 || selectedPrimaryFocuses.has(focus);
                const toggle = document.createElement('button');
                const color = PRIMARY_FOCUS_COLORS[focus] || '#4E61D3';
                const iconClass = PRIMARY_FOCUS_ICONS[focus];
                const activeStyles = `background-color: ${color}1a; color: #1f2937; border-color: ${color};`;
                const inactiveStyles = 'background-color: #f3f4f6; color: #1f2937; border-color: #e5e7eb;';
                toggle.className = 'px-4 py-2 rounded-md font-medium transition flex items-center gap-2 border';
                toggle.style.cssText = isSelected ? activeStyles : inactiveStyles;
                toggle.dataset.focusColor = color;
                toggle.setAttribute('title', formatLabel(focus));
                toggle.innerHTML = `
                    ${iconClass ? `<i class="${iconClass} text-base" aria-hidden="true"></i>` : ''}
                    <span>${formatLabel(focus)}</span>
                `;
                toggle.addEventListener('click', () => togglePrimaryFocus(focus));
                container.appendChild(toggle);
            });
        }

        function togglePrimaryFocus(focus) {
            if (selectedPrimaryFocuses.has(focus)) {
                selectedPrimaryFocuses.delete(focus);
            } else {
                selectedPrimaryFocuses.add(focus);
            }
            renderPrimaryFocusToggles();
        }

        function encodeSelectedCategories() {
            if (selectedFailureModes.size === 0 && selectedPrimaryFocuses.size === 0) {
                return GRID_KEYS.map(() => '0').join('');
            }

            const failures = selectedFailureModes.size ? Array.from(selectedFailureModes) : FAILURE_MODES;
            const focuses = selectedPrimaryFocuses.size ? Array.from(selectedPrimaryFocuses) : PRIMARY_FOCUSES;
            const combos = new Set();
            failures.forEach(fm => {
                focuses.forEach(pf => combos.add(`${fm}:${pf}`));
            });

            return GRID_KEYS.map(key => (combos.has(key) ? '1' : '0')).join('');
        }

        function decodeSelectedCategories(encoded) {
            if (!encoded || encoded.length !== GRID_KEYS.length) {
                selectedFailureModes = new Set();
                selectedPrimaryFocuses = new Set();
                return;
            }

            const combos = new Set();
            GRID_KEYS.forEach((key, idx) => {
                if (encoded[idx] === '1') {
                    combos.add(key);
                }
            });

            if (combos.size === 0) {
                selectedFailureModes = new Set();
                selectedPrimaryFocuses = new Set();
                return;
            }

            const failuresInCombos = new Set();
            const focusesInCombos = new Set();
            combos.forEach(key => {
                const [fm, pf] = key.split(':');
                failuresInCombos.add(fm);
                focusesInCombos.add(pf);
            });

            selectedFailureModes = failuresInCombos.size === FAILURE_MODES.length ? new Set() : failuresInCombos;
            selectedPrimaryFocuses = focusesInCombos.size === PRIMARY_FOCUSES.length ? new Set() : focusesInCombos;
        }

        function updateURL() {
            const filters = getCurrentFilters();
            const params = new URLSearchParams();

            if (filters.dateFilter.type !== '7') {
                params.set('date', filters.dateFilter.type);
                if (filters.dateFilter.type === 'custom') {
                    if (filters.dateFilter.start) params.set('dateStart', filters.dateFilter.start);
                    if (filters.dateFilter.end) params.set('dateEnd', filters.dateFilter.end);
                }
            }

            const hasNonZeroWeight = Object.values(filters.weights).some(w => w > 0);
            if (hasNonZeroWeight) {
                params.set('weights', Object.values(filters.weights).join(','));
            }

            const categoriesBinary = encodeSelectedCategories();
            if (categoriesBinary.includes('1')) {
                params.set('categories', categoriesBinary);
            }

            const feedArray = Array.from(selectedFeeds);
            if (feedArray.length > 0 && feedArray.length < allFeeds.length) {
                params.set('feeds', feedArray.join(','));
            }

            const url = params.toString() ? `?${params.toString()}` : window.location.pathname;
            window.history.replaceState({}, '', url);
        }

        function loadStateFromURL() {
            const params = new URLSearchParams(window.location.search);

            if (params.has('date')) {
                const dateType = params.get('date');
                document.getElementById('dateQuick').value = dateType;
                if (dateType === 'custom') {
                    document.getElementById('customDateRange').classList.remove('hidden');
                    if (params.has('dateStart')) {
                        document.getElementById('dateStart').value = params.get('dateStart');
                    }
                    if (params.has('dateEnd')) {
                        document.getElementById('dateEnd').value = params.get('dateEnd');
                    }
                }
            }

            if (params.has('weights')) {
                const weights = params.get('weights').split(',').map(w => parseInt(w, 10));
                const weightKeys = ['interpretability', 'understanding', 'safety', 'technicality', 'surprisal'];
                weights.forEach((w, i) => {
                    if (!Number.isNaN(w) && weightKeys[i]) {
                        document.getElementById(`weight-${weightKeys[i]}`).value = w;
                    }
                });
            }

            if (params.has('categories')) {
                const encoded = params.get('categories');
                if (/^[01]+$/.test(encoded)) {
                    decodeSelectedCategories(encoded);
                }
            }

            if (params.has('feeds')) {
                selectedFeeds = new Set(params.get('feeds').split(',').filter(Boolean));
            } else {
                selectedFeeds = new Set();
            }
        }

        function resetWeights() {
            const weightKeys = ['interpretability', 'understanding', 'safety', 'technicality', 'surprisal'];
            weightKeys.forEach(key => {
                document.getElementById(`weight-${key}`).value = 0;
            });
            updateWeightDisplays();
        }

        function shareLink() {
            const url = window.location.href;
            navigator.clipboard.writeText(url).then(() => {
                alert('Link copied to clipboard!');
            });
        }

        async function updateView() {
            const filters = getCurrentFilters();

            let filtered = allArticles;
            filtered = filterByDate(filtered, filters.dateFilter);
            filtered = filterByCategories(filtered);
            filtered = filterByFeeds(filtered);

            const sorted = sortArticles([...filtered], filters.weights);

            renderArticles(sorted);
            updateWeightDisplays();
            updateURL();
        }

        async function init() {
            const response = await fetch('/api/data');
            const data = await response.json();

            allArticles = data.articles;
            allFeeds = data.feeds;

            loadStateFromURL();
            renderFeedToggles();
            renderPrimaryFocusToggles();
            renderFailureModeToggles();
            updateWeightDisplays();

            document.getElementById('dateQuick').addEventListener('change', (e) => {
                const isCustom = e.target.value === 'custom';
                document.getElementById('customDateRange').classList.toggle('hidden', !isCustom);
            });

            document.getElementById('dateStart').addEventListener('change', () => {});
            document.getElementById('dateEnd').addEventListener('change', () => {});

            ['interpretability', 'understanding', 'safety', 'technicality', 'surprisal'].forEach(key => {
                document.getElementById(`weight-${key}`).addEventListener('input', updateWeightDisplays);
            });

            document.getElementById('resetWeights').addEventListener('click', resetWeights);
            document.getElementById('shareLink').addEventListener('click', shareLink);

            document.getElementById('showResults').addEventListener('click', () => {
                updateView();
            });

            await updateView();
        }

        init();
</script>
